---
title: 积分系统
description: VibeAny提供了积分系统集成，您可以轻松配置积分系统来支持商业化。
---

## 基础设置

- `enabled`：是否开启积分系统
- `allowFreeUserPurchaseCredits`：是否允许免费用户购买积分包
- `signupBonusCredits`：注册赠送积分（可选）

```tsx title="src/config/core/website-config.tsx"
 payment: {
    ...其他配置...
    credit: {
      enabled: false,
      allowFreeUserPurchaseCredits: false,
      signupBonusCredits: {
        enabled: false,
        amount: 0,
        expireDays: 0,
      },
      ...其他配置...
    },
  },
```


## 使用积分包
积分包是订阅无关的，您可以配置多个积分包，用户可以购买积分包来获取额外的积分。

- `id`：积分包ID
- `credit`：积分配置
  - `amount`：积分数量
  - `expireDays`：积分有效期（可选），如果为空，则积分永久有效
- `price`：积分包价格
  - `priceId`：积分包价格ID
  - `amount`：积分包价格
  - `currency`：积分包价格货币

```tsx title="src/config/core/website-config.tsx"
 payment: {
    ...其他配置...
    credit: {
      enabled: false,
      ...其他配置...
      packages: [
        {
          id: "credit_100",
          credit: {
            amount: 100,
            expireDays: 31,
          },
          price: {
            priceId: process.env.NEXT_PUBLIC_STRIPE_100_CREDITS_PRICE_ID!,
            amount: 990,
            currency: "USD",
          },
        },
        {
          id: "credit_200",
          credit: {
            amount: 200,
            expireDays: 30,
          },
          price: {
            priceId: process.env.NEXT_PUBLIC_STRIPE_200_CREDITS_PRICE_ID!,
            amount: 1990,
            currency: "USD",
          },
        },
      ],
    },
  },
```

## 订阅积分
订阅积分是订阅相关的，用户在订阅时可以获得积分，您只需要在 `planWithPrice` 中添加 `credit` 配置即可。

- `amount`：积分数量
- `expireDays`：积分有效期（可选），如果为空，则积分永久有效（对于订阅计划，可以不进行配置，VibeAny 会自动按照订阅计划的周期计算，不建议对订阅计划配置和订阅周期不同的有效期）
```ts title="src/services/payment/adapter/utils.ts"
// 计算积分有效期的代码参考
let expiresAt: Date | undefined
  if (plan.planType === PlanTypes.SUBSCRIPTION) {
    expiresAt = periodEnd
  } else if (plan.credit.expireDays) {
    expiresAt = new Date()
    expiresAt.setDate(expiresAt.getDate() + plan.credit.expireDays)
  }
```

```json title="src/config/core/website-config.tsx"
  planWithPrice: [
    {
      id: "free",
      planType: PlanTypes.FREE,
      prices: [],
    },
    {
      id: "pro",
      planType: PlanTypes.SUBSCRIPTION,
      credit: {
        amount: 100,
        expireDays: 31,
      },
      prices: [
        {
          type: PaymentTypes.SUBSCRIPTION,
          priceId: process.env.NEXT_PUBLIC_STRIPE_PRO_MONTHLY_PRICE_ID!,
          amount: 990,
          currency: "USD",
          interval: PlanIntervals.MONTH,
        },
        {
          type: PaymentTypes.SUBSCRIPTION,
          priceId: process.env.NEXT_PUBLIC_STRIPE_PRO_YEARLY_PRICE_ID!,
          amount: 9900,
          currency: "USD",
          interval: PlanIntervals.YEAR,
        },
      ],
      recommended: true,
    },
    ...其他配置...
  ],
```

因为积分系统是和支付系统绑定的，所以您需要确保支付功能已经配置完成。

import { HandCoins } from 'lucide-react';

<Cards>
  <Card icon={<HandCoins />} href="/docs/integration/stripe" title="支付集成">
    集成支付功能
  </Card>
</Cards>
