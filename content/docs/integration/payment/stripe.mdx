---
title: Stripe 支付集成
description: VibeAny支持多种支付平台，包括Stripe和Creem，但您只能选择一种进行配置。
---

## 基础设置
<div className="fd-steps">
  <div className="fd-step" >
    ### 创建Stripe账号
    [Stripe官网](https://stripe.com/)
  </div>
  <div className="fd-step">
    ### 获取公钥和密钥
    - 进入控制台，点击 `Developers` > `API Keys`
    - 复制公钥和密钥（注意：公钥测试模式以 pk_test_ 开头，生产模式以 pk_live_ 开头，密钥测试模式以 sk_test_ 开头，生产模式以 sk_live_ 开头）
    - 将其保存到 .env 文件中作为 NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY 和 STRIPE_SECRET_KEY
    ### 获取 生产环境的 webhook 密钥
    <Callout type="warn">
     如果您还没有域名且没有部署，可以先使用测试环境，后续再配置生产环境，且建议本地测试后再配置生产环境
    </Callout>
    - 点击 `Add endpoint`
    - 输入 Webhook URL：`https://your-domain.com/api/webhooks/stripe`
    - 选择要监听的事件：
      - `customer.subscription.created`
      - `customer.subscription.updated`
      - `customer.subscription.deleted`
      - `checkout.session.completed`
    - 点击 `Save`
    - 复制 webhook 密钥
    - 将其保存到 .env 文件中作为 STRIPE_WEBHOOK_SECRET
    ### 获取 测试环境的 webhook 密钥
    - 对于本地开发，需要使用 Stripe CLI 将事件转发到您的本地服务器：
    <CommandTab code="install -g stripe/stripe-cli" />
    - 登入到 Stripe CLI：
    ```bash
    stripe login
    ```
    - 转发事件到本地服务器：
    ```bash
    stripe listen --forward-to http://localhost:3355/api/payment/webhook
    ```
    - 复制终端中的签名密钥，并保存到 .env 文件中作为 STRIPE_WEBHOOK_SECRET_TEST
    ```
    STRIPE_WEBHOOK_SECRET=whsec_...
    ```
  </div>
</div>


## 网站设置
在配置完基础的设置后，您需要开启支付功能，并配置支付计划。

```tsx title="src/config/core/website-config.tsx"
payment: {
  enabled: true,
  provider: "stripe",
},
```

其中，provider 为 stripe，enabled 为 true。

```tsx title="src/config/core/website-config.tsx"
 planWithPrice: [
    {
      id: "free",
      planType: PlanTypes.FREE,
      prices: [],
    },
    {
      id: "pro",
      planType: PlanTypes.SUBSCRIPTION,
      prices: [
        {
          type: PaymentTypes.SUBSCRIPTION,
          priceId: process.env.NEXT_PUBLIC_STRIPE_PRO_MONTHLY_PRICE_ID!,
          amount: 990,
          currency: "USD",
          interval: PlanIntervals.MONTH,
        },
        {
        type: PaymentTypes.SUBSCRIPTION,
          priceId: process.env.NEXT_PUBLIC_STRIPE_PRO_YEARLY_PRICE_ID!,
          amount: 9990,
          currency: "USD",
          interval: PlanIntervals.YEAR,
        },
      ],
      recommended: true,
    },
    {
      id: "lifetime",
      planType: PlanTypes.LIFETIME,
      prices: [
        {
          type: PaymentTypes.ONE_TIME,
          priceId: process.env.NEXT_PUBLIC_STRIPE_LIFETIME_PRICE_ID!,
          amount: 19900,
          currency: "USD",
        },
      ],
    },
  ],
```


## 测试卡
在测试环境下，你不必使用真实的卡号，可以使用测试卡号进行测试。

- `4242 4242 4242 4242` 成功卡号
- `4000 0000 0000 9995` 资金不足卡号

更多可以参考 [Stripe 测试卡](https://docs.stripe.com/testing#cards)。


## Q&A
### 如何设置微信和支付宝
进入 `Settings` > `Payment` > `Payment Methods`
![](/docs/intergration/payment/stripe-wechat-alipay.avif)
