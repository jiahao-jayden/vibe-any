---
title: 分析系统
description: 统一的多平台分析追踪系统
---

import { Callout } from 'fumadocs-ui/components/callout'

# 分析系统

一个强大的统一分析追踪系统，支持同时使用多个分析平台。通过单一 API 在 8+ 个分析提供商之间追踪用户行为、转化和自定义事件。

<Callout type="info">
分析系统采用"配置即启用"的方式 - 只有您配置的平台才会接收数据。
</Callout>

> hook 位于 `src/hooks/use-analytics`。仅当设置了环境变量，对应平台才会启用。

## 核心特性

### 多平台同步 (＾▽＾)
```typescript
// 一次调用，多平台同步
const { track } = useAnalytics()
track('button_click', { button_name: 'subscribe' })
// → 自动发送到所有配置的平台
```

### 容错机制 (・ω・)
- 提供商故障不影响其他平台
- SSR 环境下优雅降级
- 静默错误处理

### 类型安全 (￣▽￣)
- 完整的 TypeScript 支持
- 事件属性自动补全
- 编译时错误检查

### 性能优化 (｀・ω・´)
- 动态导入实现代码分割
- useCallback 优化
- 最小化包体积影响

## 配置与使用

<div className="fd-steps">
  <div className="fd-step">
    ### 1）添加环境变量
    只为需要的平台在 `.env` 中添加变量（未配置的平台默认关闭）。
    ```bash
    NEXT_PUBLIC_GA_ID=G-XXXXXXXXXX
    NEXT_PUBLIC_POSTHOG_KEY=phc_xxxxxxxxxxxx
    NEXT_PUBLIC_PLAUSIBLE_DOMAIN=yourdomain.com
    # 按需补充其他平台
    ```
  </div>
  <div className="fd-step">
    ### 2）确保挂载
    项目已内置引导。若做二次集成，确保在应用布局中挂载一次分析初始化。
  </div>
  <div className="fd-step">
    ### 3）开始上报
    在客户端组件中使用 `@/hooks/use-analytics` 提供的 hook。

    ```ts
    import { useAnalytics, useAnalyticsEvents } from '@/hooks/use-analytics'
    const { track, identify, pageView } = useAnalytics()
    const events = useAnalyticsEvents()
    ```
  </div>
  <div className="fd-step">
    ### 4）验证
    触发一条测试事件，去各平台控制台确认是否已接收。
  </div>
</div>

## 支持的事件

常用调用如下，按需使用：

### 核心追踪函数
- `track(eventName, properties)` - 通用事件追踪
- `identify(userId, traits)` - 用户识别
- `pageView(title, path)` - 页面浏览追踪

### 专门的事件助手
- `click(element, location)` - 按钮/链接点击
- `formSubmit(formName)` - 表单提交
- `fileDownload(fileName)` - 文件下载（交互上报）
- `externalLink(url)` - 外链点击
- `signUp(method)` - 用户注册
- `login(method)` - 用户登录
- `purchase(value, currency)` - 购买转化
- `videoPlay(title)` - 视频播放
- `searchLegacy(term)` - 旧版搜索事件
- `aiChatSession(model, count)` - AI 会话统计
- `featureUsage(name)` - 功能使用
- `pageDwell(url, ms)` - 页面停留时长
- `error(error, context)` - 错误追踪
- `performance(metric, value, unit?)` - 性能指标
- `search(query, results?)` - 搜索
- `download(fileName, fileType?, fileSize?)` - 文件下载（统一下载事件）

## 常见问题 Q&A

**Q: 事件没有上报怎么办？**  
**A:** 请先确认 `.env.local` 中的公共 Token 是否配置正确（例如 `NEXT_PUBLIC_GA_ID`、`NEXT_PUBLIC_POSTHOG_KEY` 等）。系统是“配置即启用”，只有已配置的平台才会接收数据。另外需要确保在浏览器侧调用 `useAnalytics()`/`useAnalyticsEvents()`，不要在 SSR 阶段直接上报事件 (＞﹏＜)。

**Q: 如何记录页面浏览？**  
**A:** 使用 `useAnalytics().pageView(title, path)` 在布局初始化或路由变化时触发；在 App Router 下建议在顶层布局/模板中统一调用一次（或在路由切换时调用），避免重复。(＾_＾)

**Q: 如何避免重复点击事件？**  
**A:** 可以在业务侧为事件增加去重键（例如同一按钮在同一会话只记录一次），或为按钮点击加上节流/防抖。对于表单提交事件，建议在提交成功后再上报，减少噪音。(=^_^=)

**Q: 如何新增一个分析平台？**  
**A:** 在统一追踪层扩展对应 provider（参考 `@/components/analytics/track` 的注册方式），并通过环境变量或配置开关启用。保持统一的 `track/identify/pageView` 接口，业务层无需改动 (・∀・)。

**Q: 隐私与合规怎么处理？**  
**A:** 未配置的 Token 默认不启用该平台。若需要“同意后再追踪”，可在用户同意后再调用 `track`/`identify`，或在 provider 初始化前做条件判断。敏感字段请不要直接上报，必要时做脱敏处理 (￣ー￣)。

**Q: 购买转化如何记录？**  
**A:** 使用 `useAnalyticsEvents().purchase(value, currency)`，或调用 `conversion('purchase', value, currency)`；配合后端订单校验可在成功页或 webhook 完成后做最终归因 (＾▽＾)。

{/* 精简：移除深层链接；本页即为入口与指南。 */}
